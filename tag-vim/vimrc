" === 插件管理 ===
" 初始化插件系统
call plug#begin()

" coc.nvim: 提供代码补全、语法检查和导航功能
Plug 'neoclide/coc.nvim', {'do': 'yarn install --frozen-lockfile'}

" NERDTree: 显示文件树以便于导航
Plug 'scrooloose/nerdtree'
Plug 'ryanoasis/vim-devicons'

" vim-surround: 简化用括号、引号等包围文本的过程
Plug 'tpope/vim-surround'

" auto-pairs: 自动关闭括号、引号等
Plug 'jiangmiao/auto-pairs'

" a.vim: 快速在源文件和头文件之间切换（适用于 C++ 开发）
Plug 'vim-scripts/a.vim'

" 注释
Plug 'preservim/nerdcommenter'


" vim-cpp-enhanced-highlight: 增强 C++ 代码的语法高亮
Plug 'octol/vim-cpp-enhanced-highlight'

" 状态行插件
Plug 'vim-airline/vim-airline'

" vim-rainbow: 用不同的颜色匹配括号（彩虹括号）
Plug 'frazrepo/vim-rainbow'

" 主题
Plug 'morhetz/gruvbox'


"  插件定义结束
call plug#end()

" 启用 24 位真彩色支持，以获得更好的颜色效果
if has("termguicolors")
	set termguicolors
endif

" 设置背景透明（兼容性更好的方式）
augroup MyColors
	autocmd!
	autocmd ColorScheme * highlight Normal ctermbg=NONE guibg=NONE
	autocmd ColorScheme * highlight NonText ctermbg=NONE guibg=NONE
	autocmd ColorScheme * highlight LineNr ctermbg=NONE guibg=NONE
	autocmd ColorScheme * highlight SignColumn ctermbg=NONE guibg=NONE
augroup END

colorscheme gruvbox
" 调整
set bg=dark


" === 基本编辑器设置 ===
" 始终显示状态行
set laststatus=2

" 让光标不接触上下边界
set scrolloff=5

" 使用 UTF-8 编码
set encoding=utf-8

" 禁用备份文件
set nobackup
set nowritebackup

" 启用语法高亮
syntax on
syntax enable

" 设置缩进：每个制表符/缩进使用 4 个空格
set shiftwidth=4
set tabstop=4

" 启用 C 风格的缩进
set cindent

" 显示行号
set number
set relativenumber 

" 使用基于缩进的折叠
set foldmethod=indent

" 在状态行中显示正在输入的命令
set showcmd

" 高亮搜索结果
set hlsearch

" 启用增量搜索
set incsearch

" 设置wildmenu
set wildmenu 

"设置vim与系统共用一个剪切板
set clipboard=unnamedplus

" === 文件路径和文件类型设置 ===
" 将 '/usr/include' 添加到搜索路径中
" set path^=/usr/include

" 启用文件类型特定的缩进
filetype indent on

" === 补全设置 ===
" 使用 <TAB> 在补全菜单中选择下一个项
inoremap <silent><expr> <TAB> coc#pum#visible() ? coc#pum#next(1) : "\<TAB>"

" 使用 <S-TAB>（Shift + TAB）选择上一个项
inoremap <silent><expr> <S-TAB> coc#pum#visible() ? coc#pum#prev(1) : "\<S-TAB>"

" 使用 <CR> 确认补全选项或执行默认的回车行为
inoremap <silent><expr> <CR> coc#pum#visible() ? coc#pum#confirm() : "\<CR>"

" 设置代码导航的键映射（跳转到定义、类型定义等）
nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gy <Plug>(coc-type-definition)
nmap <silent> gi <Plug>(coc-implementation)
nmap <silent> gr <Plug>(coc-references)

" === 附加功能设置 ===
" 键位绑定
let mapleader = ";"
nnoremap <Leader>q :q<CR>
nnoremap <Leader>w :w<CR>
nnoremap <Leader>f :NERDTreeFind<CR>
nnoremap <Leader>g ::NERDTreeToggle<CR>
" 标签
nnoremap <Leader>h :tabprevious<CR>
nnoremap <Leader>l :tabnext<CR>
nnoremap <Leader>n :tabnew<Space>
" C++相关的
nnoremap <Leader>m :!~/.scripts/compile.sh %<CR>
nnoremap <Leader>e :!~/.scripts/execute.sh %<CR>
nnoremap <Leader>r :!~/.scripts/run.sh %<CR>

" ===分屏====
nnoremap sv :vsplit<CR><C-w h>
nnoremap sh :split<CR><C-w j>

" Shift + HJKL 快速移动光标
nnoremap <S-h> ^
nnoremap <S-j> 5j
nnoremap <S-k> 5k
nnoremap <S-l> $

inoremap jk <Esc>

" === 特殊配置 ===
" 启用彩虹括号功能
let g:rainbow_active = 1  


" 启用增强的 C++ 语法高亮特性
let g:cpp_class_scope_highlight=1
let g:cpp_variable_highlight=1
let g:cpp_class_decl_highlight=1

" airline
set showtabline=2
let g:airline_powerline_fonts=1
let g:airline#extensions#tabline#enabled = 1
let g:airline#extensions#tabline#show_buffers = 0
let g:airline#extensions#tabline#show_splits = 0
let g:airline#extensions#tabline#show_tab_count = 0
let g:airline#extensions#tabline#show_close_button = 0
let g:airline#extensions#tabline#fnamemod = ':t'
let g:airline#extensions#tabline#formatter = 'unique_tail'

" 设置 vim-airline 的主题
let g:airline_theme = 'gruvbox'

" 启用NERDTree
let g:NERDTreeShowLineNumbers=1
let g:NERDTreeDirArrows=1

" 启用devicons
let g:WebDevIconsUnicodeDecorateFolderNodes = 1
let g:WebDevIconsUnicodeDecorateFileNodes = 1
let g:DevIconsEnableFoldersOpenClose = 1



" 注释
let g:NERDCreateDefaultMappings = 1
let g:NERDCommenterCommentString = {
			\ 'python': '# %s',
			\ 'javascript': '// %s',
			\ 'html': '<!-- %s -->',
			\ 'css': '/* %s */',
			\ 'cpp': '// %s',
			\ 'sh': '# %s',
			\ }


